<% provide(:title, "Vacation Rentals") %>
<h1>Listing rentals</h1>

<%#= render 'filter_form' %>
<%= form_tag(rentals_path,
             :method => :get) do %>
    <%= select_tag(:destination_id,
                   options_from_collection_for_select(Destination.all, :id, :name)) %>
    <%= submit_tag %>
<% end %>

<%= form_tag(rentals_path,
             :method => :get) do %>
    <%= select(:sleeps, :num, Rental.pluck(:sleeps).uniq,
               {:prompt => "Select Sleeps Filter"}) %>
    <%= submit_tag %>
<% end %>

<%= form_tag(rentals_path,
             :method => :get) do %>
    <%= select(:bedrooms, :num, Rental.pluck(:bedrooms).uniq,
               {:prompt => "Select Bedroom Filter"}) %>
    <%= submit_tag %>
<% end %>

<div class="dest-index">
  <div class="row">
    <div class="span2">
      <form class="destination-index-form">
        <fieldset>
          <legend>Filter your search</legend>
          <label>Location:</label>
          <% unless @rentals_no_filter.nil? %>
            <% @rentals_no_filter.each do |rental| %>
                <label class="checkbox">
                  <input type="checkbox"> <%= rental.destination.name  %>
                </label>
            <% end %>
          <label>Features:</label>
          <% Feature.all.each do |feature| %>
              <% unless feature.name.blank? %>
                  <label class="checkbox">
                    <input type="checkbox"> <%= feature.name  %>
                  </label>
              <% end %>
          <% end %>
            <label>Occupancy:</label>
              <% @rentals_no_filter.each do |rental| %>
                  <label class="checkbox">
                    <input type="checkbox"> <%= rental.sleeps  %>
                  </label>
              <% end %>
              <label>Bedrooms:</label>
              <% @rentals_no_filter.each do |rental| %>
                  <label class="checkbox">
                    <input type="checkbox"> <%= rental.bedrooms  %>
                  </label>
              <% end %>
          <% end %>
          <label>Price:</label>
          <label class="checkbox">
            <input type="checkbox"> - 500&euro;
          </label>
          <label class="checkbox">
            <input type="checkbox"> 500&euro; - 1.000&euro;
          </label>
          <label class="checkbox">
            <input type="checkbox"> 1.000&euro; - 1.500&euro;
          </label>
          <label class="checkbox">
            <input type="checkbox"> + 1.500&euro;
          </label>
          <div class="center">
            <button type="submit" class="btn">Submit</button>
          </div>
        </fieldset>
      </form>
    </div>
    <div class="span10">
      <% @rentals_no_filter.each do |rental| %>
          <div class="row">
            <p class="lead span10"><%= link_to rental.name, rental  %></p>
            <p class="span10">Vacation Rental in <%= link_to rental.destination.name,
                                              destination_path(rental.destination)  %></p>
            <div class="span7">
              <% unless rental.photos.nil? %>
                  <%= link_to image_tag(rental.photos.first.url), rental %>
              <% end %>
            </div>
            <div class="span3 zebra-index no-left-margin">
              <p><%= raw truncate(strip_tags(rental.content), :length => 200) %></p>
              <%= link_to 'Show', rental %> |
              <%= link_to 'Edit', edit_rental_path(rental) %> |
              <%= link_to 'Destroy', rental, method: :delete, data:
                      { confirm: 'Are you sure?' } %>
            </div>
          </div>
      <% end %>
    </div>
  </div>
</div>

<br />

<% if current_user %>
    <%= link_to 'New Rental', new_rental_path,
                class: 'btn btn-warning btn-large' %>
<% end %>